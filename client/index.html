<!DOCTYPE html>​
​<html lang="en" ng-app="discussions">​
​<head>​
	<meta charset="UTF-8">​
	<title>Customers | Store</title>​
	
​
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>​
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>​
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">​
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"/></script>​
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.min.js"></script> 
   
   <script>
   var discussions = angular.module('discussions', ['ngRoute']);
       var person = prompt("Please enter your name");
discussions.config(function($routeProvider){
    $routeProvider
    .when('/',{
        templateUrl: 'partials/dashboard.html'
    })
    .when('/topic/:id', {
        templateUrl: 'partials/topic.html'
    })
});

discussions.controller('NewPost',function($scope,$location,$routeParams, NewTopicFactory){

    NewTopicFactory.get_one_topic($routeParams.id, function(data){
        console.log(data);
        $scope.topic = data;
    })

    $scope.addPost = function(id){
        //console.log(id);
        NewTopicFactory.addPost(id, $scope.new_post);
        $scope.new_post = {};
    }
    $scope.upVote = function(id){
        //console.log(topicid);
        //console.log(postid);
        NewTopicFactory.addLike(id);
    }

})
discussions.controller('Dashboards', function($scope,$location,$routeParams, NewTopicFactory){
    NewTopicFactory.getTopics(function(data){
        $scope.topics = data;
    })

    $scope.addTopic = function(){
        NewTopicFactory.addTopic($scope.newTopic,function(){
            NewTopicFactory.getTopics(function(data){
                $scope.topics = data;
                $scope.newTopic = {} ;
            })
        });
    }

})


discussions.factory('NewTopicFactory',function($http){
    var factory = {};
    factory.getTopics = function(callback){
        $http.get('/get_topics').success(function(output){
            callback(output);
        });        
    };
    factory.get_one_topic = function(id,callback){
        $http.get('/get_one_topic/'+id).success(function(output){
            //console.log(output);
            callback(output[0]);
        });        
    }
    factory.addTopic = function(info,callback){
        if(info.topic.length < 11) {
           console.log('Not a vaild question, must be at least 10 characters long');
            return false;
        }else {
            info.name = person;
            $http.post('/add_topic', info).success(function(output){
              callback(output);     // console.log(output);
            });  
                   
        }
    };

    factory.addLike = function(id){
        $http.get('/like_post/'+id).success(function(output){
            console.log(output);
        })
    }

    factory.addPost =  function(id, info){
        var post = info.post;
        if(post.length < 6) {
            console.log("Post must be at least 5 characters");
            return false;
        }else{
            info.id = id;
            info.name = person;
            $http.post('/add_post', info).success(function(output){
                //console.log(output);
            });            
        }
    }
    return factory;

});

    </script>​
​</head>​
​<body>​

<div ng-view="">
</div>
​</body>​
​</html>
